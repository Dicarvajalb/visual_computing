<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Parte 2 # Colisiones y Creacion: Tomando lo creado en los ejercicios anteriores se crea un laberinto sencillo por el cual la esfera pueda desplazarse, se trata de simular fisicas como fuerzas Newtonianas para dar realismo a la aplicacion. ¿Como interactuar con el plano? Para cambiar la inclinacion debe deslizar el mouse presionando el boton de click derecho sobre el Canvas, la esfera puede salirse del plano y del area visible por lo cual puede usar el slider para ajustar el zoom o el boton central del mouse."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Parte 2 # Colisiones y Creacion: Tomando lo creado en los ejercicios anteriores se crea un laberinto sencillo por el cual la esfera pueda desplazarse, se trata de simular fisicas como fuerzas Newtonianas para dar realismo a la aplicacion. ¿Como interactuar con el plano? Para cambiar la inclinacion debe deslizar el mouse presionando el boton de click derecho sobre el Canvas, la esfera puede salirse del plano y del area visible por lo cual puede usar el slider para ajustar el zoom o el boton central del mouse."><meta property="og:type" content="article"><meta property="og:url" content="https://dicarvajalb.github.io/visual_computing/docs/shortcodes/Taller-2/Aplicacion-3-D/LaberintoP2/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-10-19T09:25:35-05:00"><title>Laberinto P2 | Grupo de estudio</title><link rel=manifest href=/visual_computing/manifest.json><link rel=icon href=/visual_computing/favicon.png type=image/x-icon><link rel=stylesheet href=/visual_computing/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/visual_computing/flexsearch.min.js></script>
<script defer src=/visual_computing/en.search.min.608673950bae0f50a3e54f6f9e2508adbd48a76d90e66406ec5983ef666f4ca7.js integrity="sha256-YIZzlQuuD1Cj5U9vniUIrb1Ip22Q5mQG7FmD72ZvTKc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/visual_computing/><span>Grupo de estudio</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Shortcodes</span><ul><li><input type=checkbox id=section-543c92395a5da43e568c54aed57a7bf6 class=toggle>
<label for=section-543c92395a5da43e568c54aed57a7bf6 class="flex justify-between"><a href=/visual_computing/docs/shortcodes/Taller-1/>Taller 1</a></label><ul><li><a href=/visual_computing/docs/shortcodes/Taller-1/Convoluciones/>Convoluciones</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-1/Histograma/>Histograma</a></li><li><input type=checkbox id=section-eb58e35b3307a51faa32e78ab05d9c64 class=toggle>
<label for=section-eb58e35b3307a51faa32e78ab05d9c64 class="flex justify-between"><a href=/visual_computing/docs/shortcodes/Taller-1/Ilusiones/>Ilusiones</a></label><ul><li><a href=/visual_computing/docs/shortcodes/Taller-1/Ilusiones/BindingMovement/>Binding Movement</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-1/Ilusiones/SKE/>Ske</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-1/Ilusiones/SteppingFeet/>Stepping Feet</a></li></ul></li><li><a href=/visual_computing/docs/shortcodes/Taller-1/Lightness/>Lightness</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-1/Multiplicacion-RGB/>Multiplicacion Rgb</a></li></ul></li><li><input type=checkbox id=section-3339356ac915f37974c010a9ff982b95 class=toggle checked>
<label for=section-3339356ac915f37974c010a9ff982b95 class="flex justify-between"><a href=/visual_computing/docs/shortcodes/Taller-2/>Taller 2</a></label><ul><li><input type=checkbox id=section-aec318664ee87e724026f45da2e6fe01 class=toggle checked>
<label for=section-aec318664ee87e724026f45da2e6fe01 class="flex justify-between"><a href=/visual_computing/docs/shortcodes/Taller-2/Aplicacion-3-D/>Aplicacion 3 D</a></label><ul><li><a href=/visual_computing/docs/shortcodes/Taller-2/Aplicacion-3-D/Laberinto/>Laberinto</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-2/Aplicacion-3-D/LaberintoP2/ class=active>Laberinto P2</a></li></ul></li><li><input type=checkbox id=section-3e0f43450c6fe10e0095878dad3831f3 class=toggle>
<label for=section-3e0f43450c6fe10e0095878dad3831f3 class="flex justify-between"><a href=/visual_computing/docs/shortcodes/Taller-2/Rasterizacion/>Rasterizacion</a></label><ul><li><a href=/visual_computing/docs/shortcodes/Taller-2/Rasterizacion/Midpoint-Circle-Algorithm/>Midpoint Circle Algorithm</a></li><li><a href=/visual_computing/docs/shortcodes/Taller-2/Rasterizacion/Triangle-Rasterization/>Triangle Rasterization</a></li></ul></li></ul></li></ul></li></ul><ul><li><a href=/visual_computing/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/visual_computing/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Laberinto P2</strong>
<label for=toc-control><img src=/visual_computing/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#parte-2>Parte 2</a></li></ul></li><li><a href=#conclusiones>Conclusiones</a></li><li><a href=#referencias>Referencias</a></li></ul></nav></aside></header><article class=markdown><h2 id=parte-2>Parte 2
<a class=anchor href=#parte-2>#</a></h2><hr><ol start=3><li><strong>Colisiones y Creacion:</strong> Tomando lo creado en los ejercicios anteriores se crea un laberinto sencillo por el cual la esfera pueda desplazarse, se trata de simular fisicas como fuerzas Newtonianas para dar realismo a la aplicacion.</li></ol><blockquote class="book-hint info"><strong>¿Como interactuar con el plano?</strong>
Para cambiar la inclinacion debe deslizar el mouse presionando el boton de click derecho sobre el Canvas, la esfera puede salirse del plano y del area visible por lo cual puede usar el slider para ajustar el zoom o el boton central del mouse.</blockquote><p><details><summary><strong>CODIGO:</strong> Aceleracion</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Ball</span>(<span style=color:#a6e22e>P</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>acceleration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereRadius</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4.5</span>,<span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereRadius</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>minVertex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>,<span style=color:#f92672>-</span><span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>maxVertex</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>fbo</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#e6db74>&#34;rgb(0, 0, 0)&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>noStroke</span>();
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>sphere</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereRadius</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>move</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>P</span>, <span style=color:#a6e22e>acceleration</span>, <span style=color:#a6e22e>factorAcc</span>, <span style=color:#a6e22e>isAcelerate</span>){
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isAcelerate</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>isAcelerate</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>isAcelerate</span>;
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>*</span><span style=color:#a6e22e>factorAcc</span>) <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    }<span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>){
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sphereMoveVector</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>acceleration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// if(P.planeRotateV.x != 0 || P.planeRotateV.y != 0){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//     B.sphereMoveVector.x = (B.acceleration.x*0.1) + B.sphereMoveVector.x;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//     B.sphereMoveVector.y = (B.acceleration.y*0.1) + B.sphereMoveVector.y;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   
</span></span><span style=display:flex><span>  <span style=color:#75715e>//     B.spherePosition.x = (B.sphereMoveVector.x*0.1) + B.spherePosition.x
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//     B.spherePosition.y = (B.sphereMoveVector.y*0.1) + B.spherePosition.y;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   
</span></span><span style=display:flex><span>  <span style=color:#75715e>//   }else if(P.planeRotateV.x == 0 &amp;&amp; P.planeRotateV.y == 0){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//     B.sphereMoveVector = createVector(0,0,0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//     B.acceleration = createVector(0,0,0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//   }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;use strict&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// See:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/processing/p5.js/blob/main/contributor_docs/creating_libraries.md
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/processing/p5.js/blob/main/src/core/README.md
</span></span></span><span style=display:flex><span><span style=color:#75715e>// https://github.com/processing/p5.js/blob/main/contributor_docs/webgl_mode_architecture.md
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>/** @namespace  */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>Tree</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>ext</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>INFO</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>LIBRARY</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;p5.treegl&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>VERSION</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;0.3.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>HOMEPAGE</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://github.com/VisualComputing/p5.treegl&#39;</span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  Object.<span style=color:#a6e22e>freeze</span>(<span style=color:#a6e22e>INFO</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NONE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Axes consts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>X</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Z</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_X</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_Y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_Z</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LABELS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// grid style
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SOLID</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DOTS</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// bullseye and picking shape
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SQUARE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CIRCLE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// only picking shape
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>PROJECTION</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Frustum consts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NEAR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>FAR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>LEFT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>RIGHT</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BOTTOM</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>TOP</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>BODY</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// visibility
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>INVISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SEMIVISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// spaces
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;WORLD&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>EYE</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;EYE&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>NDC</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;NDC&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;SCREEN&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>MODEL</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;MODEL&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// points
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ORIGIN</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#75715e>// vectors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_i</span> <span style=color:#f92672>=</span> [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_j</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>_k</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>  <span style=color:#75715e>// shaders
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// precision
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>lowp</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mediump</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>highp</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pmvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>nMatrix</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// out
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>color4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>normal3</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>position2</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>position3</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span> <span style=color:#f92672>??=</span> {};
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>INFO</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>INFO</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>NONE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>NONE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>X</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>X</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>Y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Y</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>Z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Z</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_X</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_X</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_Y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_Y</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_Z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_Z</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>LABELS</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LABELS</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>SOLID</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SOLID</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>DOTS</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>DOTS</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>SQUARE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SQUARE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>CIRCLE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>CIRCLE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>PROJECTION</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PROJECTION</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>NEAR</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>NEAR</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>FAR</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>FAR</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>LEFT</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>LEFT</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>RIGHT</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>RIGHT</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>BOTTOM</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>BOTTOM</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>TOP</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TOP</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>BODY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>BODY</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>INVISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>INVISIBLE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>VISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>VISIBLE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>SEMIVISIBLE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SEMIVISIBLE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>WORLD</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>EYE</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>NDC</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>SCREEN</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>MODEL</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>MODEL</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>ORIGIN</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ORIGIN</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>k</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_i</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_j</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>_k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_k</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>lowp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>lowp</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>mediump</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mediump</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>highp</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>highp</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>pmvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pmvMatrix</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pMatrix</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mvMatrix</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>nMatrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>nMatrix</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>color4</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>color4</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>texcoords2</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>normal3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>normal3</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>position2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>position2</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ext</span>.<span style=color:#a6e22e>position3</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>position3</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ext</span>;
</span></span><span style=display:flex><span>})(<span style=color:#a6e22e>Tree</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>INFO</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 1. Matrix stuff
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mult3</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;mult3 only works with mat3&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>6</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>,
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat3</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mult4</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_mult4</span>([<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>]));
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_mult4</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vec4</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;_mult4 only works with mat4&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>12</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>3</span>],
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>9</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>13</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>3</span>],
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>6</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>14</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>3</span>],
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>7</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>11</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>vec4</span>[<span style=color:#ae81ff>3</span>]];
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>tMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>transpose</span>(<span style=color:#a6e22e>matrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>invMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>matrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>axbMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>b</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>b</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>iMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>lMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>lMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// defaults: from: iMatrix, to: eMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>lMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>(),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>()
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>to</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>to</span>).<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>from</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>dMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>dMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// defaults: from: iMatrix, to: eMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>dMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>(),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>(),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>matrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>from</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>from</span>).<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>to</span>)
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Note that this transposes mat4 into mat3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>(<span style=color:#e6db74>&#39;mat3&#39;</span>, [<span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>4</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>8</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>9</span>],
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>6</span>], <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>]]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>mvMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// defaults when mMatrix is defined: vMatrix: this.vMatrix, mMatrix:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// otherwise it returns a copy of the current mvMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mMatrix</span>
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>()).<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>mMatrix</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uMVMatrix</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>mMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// defaults: eMatrix: this.eMatrix, mvMatrix: this.mvMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>(),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mvMatrix</span>()
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>eMatrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>mvMatrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>nMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>nMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>nMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mvMatrix</span>({ <span style=color:#a6e22e>mMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> })
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>(<span style=color:#e6db74>&#39;mat3&#39;</span>).<span style=color:#a6e22e>inverseTranspose</span>(<span style=color:#a6e22e>mvMatrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// TODO check where to replace vMatrix for:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// this._curCamera.cameraMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>vMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_curCamera</span>.<span style=color:#a6e22e>vMatrix</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Camera</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cameraMatrix</span>.<span style=color:#a6e22e>copy</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>eMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_curCamera</span>.<span style=color:#a6e22e>eMatrix</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Camera</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cameraMatrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cameraMatrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pmvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pmvMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pmvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>mvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mvMatrix</span>({ <span style=color:#a6e22e>mMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> })
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>mvMatrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pvMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// defaults: pMatrix: this.pMatrix, vMatrix: this.vMatrix
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_curCamera</span>.<span style=color:#a6e22e>cameraMatrix</span>
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>vMatrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pvInvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pvInvMatrix</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pvInvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvMatrix</span>
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>matrix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pvMatrix</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>pvMatrix</span>.<span style=color:#a6e22e>copy</span>() <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pvMatrix</span>({ <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>matrix</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_isOrtho</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>_isOrtho</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_isOrtho</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>_isOrtho</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_isOrtho</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>nPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>nPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>nPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>nPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>nPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>14</span>] <span style=color:#f92672>/</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>14</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>fPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>fPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>14</span>] <span style=color:#f92672>/</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>]) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>14</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>10</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>lPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>lPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>lPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>lPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>lPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> <span style=color:#f92672>-</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>12</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>*</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>8</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>rPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>rPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>rPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>rPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>rPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>12</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>8</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>tPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>tPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>tPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>tPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>tPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// note that inverted values are returned if the projection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// matrix was set with @function frustum.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>13</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>*</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>9</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>bPlane</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>bPlane</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bPlane</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// note that inverted values are returned if the projection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// matrix was set with @function frustum.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>?</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>13</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>9</span>]) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>fov</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>fov</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>fov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;fov only works for a perspective projection&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>atan</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>5</span>]));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>hfov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>hfov</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>hfov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>hfov</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>hfov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;hfov only works for a perspective projection&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>atan</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>0</span>]));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2. Space transformations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>beginHUD</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>beginHUD</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>beginHUD</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mv</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mvMatrix</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pMatrix</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawingContext</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>disable</span>(<span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>DEPTH_TEST</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>resetMatrix</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> Number.<span style=color:#a6e22e>MAX_VALUE</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_curCamera</span>.<span style=color:#a6e22e>ortho</span>(<span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>endHUD</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>endHUD</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>endHUD</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>drawingContext</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>enable</span>(<span style=color:#a6e22e>gl</span>.<span style=color:#a6e22e>DEPTH_TEST</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>.<span style=color:#a6e22e>set</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>p</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uMVMatrix</span>.<span style=color:#a6e22e>set</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mv</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2.1 Points
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// NDC stuff needs testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_map</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>_map</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_map</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>start1</span>, <span style=color:#a6e22e>stop1</span>, <span style=color:#a6e22e>start2</span>, <span style=color:#a6e22e>stop2</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>n</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start1</span>) <span style=color:#f92672>/</span> (<span style=color:#a6e22e>stop1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start1</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>stop2</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start2</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>start2</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>treeLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>treeLocation</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Converts locations (i.e., points) from one space into another.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector} vector      location to be converted.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix|String} from source space: either a global
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 transform matrix or Tree.WORLD, Tree.EYE,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 Tree.SCREEN, Tree.NDC or Tree.MODEL.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix|String} to   target space: either a global
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 transform matrix or Tree.WORLD, Tree.EYE,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 Tree.SCREEN, Tree.NDC or Tree.MODEL.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pMatrix     projection matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} vMatrix     view matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pvMatrix    projection times view matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pvInvMatrix (projection times view matrix)^-1.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>treeLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>arguments</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>arguments</span>[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>instanceof</span> Object <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>ORIGIN</span>, <span style=color:#a6e22e>arguments</span>[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_treeLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>_treeLocation</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_treeLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>ORIGIN</span>,
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvInvMatrix</span>
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>vector</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>({ <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>({ <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenLocation</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_location</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInvMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCLocation</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenLocation</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCLocation</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenLocation</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_location</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenLocation</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInvMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>to</span>)).<span style=color:#a6e22e>mult4</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_location</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenLocation</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInvMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCLocation</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenLocation</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>).<span style=color:#a6e22e>mult4</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>to</span>)).<span style=color:#a6e22e>mult4</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>).<span style=color:#a6e22e>mult4</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lMatrix</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span> }).<span style=color:#a6e22e>mult4</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>to</span>)).<span style=color:#a6e22e>mult4</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_location</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span>, <span style=color:#a6e22e>pvInvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvInvMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenLocation</span>({ <span style=color:#a6e22e>vector</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>?</span> (<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>()) <span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>).<span style=color:#a6e22e>mult4</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;couldn\&#39;t parse your treeLocation query!&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>vector</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_ndcToScreenLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>),
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>),
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_screenToNDCLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>),
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_map</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_screenLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.5</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pvMatrix</span>({ <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> })
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pvMatrix</span>.<span style=color:#a6e22e>_mult4</span>([<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;screenLocation broken. Check your pvMatrix!&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>viewport</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>];
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ndc, but y is inverted
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Map x, y and z to range 0-1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Map x,y to viewport
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_location</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>0.5</span>),
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pvInvMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pvInvMatrix</span>({ <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> })
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>viewport</span> <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#f92672>-</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span> [<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Map x and y from window coordinates
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>-</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>/</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>2</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>1</span>]) <span style=color:#f92672>/</span> <span style=color:#a6e22e>viewport</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Map to range -1 to 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>source</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pvInvMatrix</span>.<span style=color:#a6e22e>_mult4</span>(<span style=color:#a6e22e>source</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;location broken. Check your pvInvMatrix!&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>/=</span> <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>target</span>[<span style=color:#ae81ff>2</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 2.2. Vectors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// NDC stuff needs testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>treeDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>treeDisplacement</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Converts displacements (i.e., vectors) from one space into another.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector} vector      location to be converted.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix|String} from source space: either a global
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 transform matrix or Tree.WORLD, Tree.EYE,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 Tree.SCREEN, Tree.NDC or Tree.MODEL.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix|String} to   target space: either a global
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 transform matrix or Tree.WORLD, Tree.EYE,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                                 Tree.SCREEN, Tree.NDC or Tree.MODEL.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pMatrix     projection matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} vMatrix     view matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pvMatrix    projection times view matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} pvInvMatrix (projection times view matrix)^-1.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>treeDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>arguments</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>arguments</span>[<span style=color:#ae81ff>0</span>] <span style=color:#66d9ef>instanceof</span> Object <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>(<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_k</span>, <span style=color:#a6e22e>arguments</span>[<span style=color:#ae81ff>0</span>]) <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_treeDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>_treeDisplacement</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_treeDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_k</span>,
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>pMatrix</span>
</span></span><span style=display:flex><span>    } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>vector</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>vector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>vector</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>({ <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>MODEL</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>({ <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span>(<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) <span style=color:#f92672>&amp;&amp;</span> (<span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span>(<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCDisplacement</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenDisplacement</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span>(<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenDisplacement</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ndcToScreenDisplacement</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NDC</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToNDCDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span> }).<span style=color:#a6e22e>mult3</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span>(<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>from</span>) }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span> }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// all cases below kept for efficiency but they all may
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// be simply expressed in terms of the previous case, by:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Tree.EYE -&gt; eMatrix()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Tree.WORLD -&gt; iMatrix()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>), <span style=color:#a6e22e>pMatrix</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>() }).<span style=color:#a6e22e>mult3</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span>(<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>vMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>()).<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>to</span>) }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>from</span>).<span style=color:#a6e22e>apply</span>(<span style=color:#a6e22e>eMatrix</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>eMatrix</span>()) }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>to</span> }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>from</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Matrix</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>to</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>dMatrix</span>({ <span style=color:#a6e22e>matrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>from</span>.<span style=color:#a6e22e>copy</span>().<span style=color:#a6e22e>invert</span>(<span style=color:#a6e22e>from</span>) }).<span style=color:#a6e22e>mult3</span>(<span style=color:#a6e22e>vector</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;couldn\&#39;t parse your treeDisplacement query!&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>vector</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_worldToScreenDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>eyeVector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>(<span style=color:#a6e22e>vector</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eyeVector</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eyeVector</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>perspective</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>perspective</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>(<span style=color:#a6e22e>position</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> }).<span style=color:#a6e22e>z</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>(<span style=color:#a6e22e>pMatrix</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dx</span> <span style=color:#f92672>/=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dy</span> <span style=color:#f92672>/=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dz</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>eyeVector</span>.<span style=color:#a6e22e>z</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// sign is inverted
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>dz</span> <span style=color:#f92672>/=</span> (<span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>fPlane</span>()) <span style=color:#f92672>/</span> (<span style=color:#a6e22e>perspective</span> <span style=color:#f92672>?</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>(<span style=color:#a6e22e>pMatrix</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>rPlane</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>lPlane</span>()) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>dx</span>, <span style=color:#a6e22e>dy</span>, <span style=color:#a6e22e>dz</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_screenToWorldDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>, <span style=color:#a6e22e>pMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>uPMatrix</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Scale to fit the screen relative vector displacement
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>perspective</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>mat4</span>[<span style=color:#ae81ff>15</span>] <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>perspective</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>(<span style=color:#a6e22e>position</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span> }).<span style=color:#a6e22e>z</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>(<span style=color:#a6e22e>pMatrix</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dx</span> <span style=color:#f92672>*=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>dy</span> <span style=color:#f92672>*=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>dz</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dz</span> <span style=color:#f92672>*=</span> (<span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>nPlane</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>fPlane</span>()) <span style=color:#f92672>/</span> (<span style=color:#a6e22e>perspective</span> <span style=color:#f92672>?</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>(<span style=color:#a6e22e>pMatrix</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>rPlane</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>pMatrix</span>.<span style=color:#a6e22e>lPlane</span>()) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>eyeVector</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>dx</span>, <span style=color:#a6e22e>dy</span>, <span style=color:#a6e22e>dz</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>(<span style=color:#a6e22e>eyeVector</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_ndcToScreenDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_screenToNDCDisplacement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>vector</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>, <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 3. Shader utilities
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>readShader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>fragFilename</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>precision</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>matrices</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>varyings</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Shader</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fragFilename</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>fragFilename</span>.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#e6db74>&#39;/&#39;</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>_vertSrc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>parseVertexShader</span>({ <span style=color:#a6e22e>precision</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>precision</span>, <span style=color:#a6e22e>matrices</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>matrices</span>, <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>varyings</span>, <span style=color:#a6e22e>_specs</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>loadStrings</span>(
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fragFilename</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>result</span> =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>_fragSrc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>shader</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>makeShader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>fragSrc</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>precision</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>matrices</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>varyings</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Shader</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;the fragment shader provided as param in makeShader()&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>_vertSrc</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>parseVertexShader</span>({ <span style=color:#a6e22e>precision</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>precision</span>, <span style=color:#a6e22e>matrices</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>matrices</span>, <span style=color:#a6e22e>varyings</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>varyings</span>, <span style=color:#a6e22e>_specs</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>_fragSrc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fragSrc</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>shader</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>parseVertexShader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>precision</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>mediump</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>matrices</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>pmvMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>varyings</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>color4</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>texcoords2</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_specs</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>floatPrecision</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`precision </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>precision</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>highp</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;highp&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>precision</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>mediump</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;mediump&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;lowp&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span><span style=color:#e6db74>}</span><span style=color:#e6db74> float;`</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>color4</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>varyings</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>color4</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>varyings</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>texcoords2</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>normal3</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>varyings</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>normal3</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position2</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>varyings</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>position2</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position3</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>varyings</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>position3</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pmv</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>matrices</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>pmvMatrix</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>matrices</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>pMatrix</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mv</span> <span style=color:#f92672>=</span> <span style=color:#f92672>~</span>(<span style=color:#a6e22e>matrices</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>mvMatrix</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>matrices</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>nMatrix</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>normal3</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`gl_Position =</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>pmv</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39; uModelViewProjectionMatrix * &#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>p</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>mv</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39; uProjectionMatrix * uModelViewMatrix *&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74> `</span><span style=color:#e6db74>}</span><span style=color:#e6db74>vec4(aPosition, 1.0)`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vertexShader</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>floatPrecision</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>attribute vec3 aPosition;
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>color4</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;attribute vec4 aVertexColor;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;attribute vec2 aTexCoord;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>normal3</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;attribute vec3 aNormal;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>pmv</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;uniform mat4 uModelViewProjectionMatrix;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>p</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;uniform mat4 uProjectionMatrix;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>mv</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;uniform mat4 uModelViewMatrix;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>n</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;uniform mat3 uNormalMatrix;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>color4</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;varying vec4 color4;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;varying vec2 texcoords2;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>normal3</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;varying vec3 normal3;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>position2</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;varying vec2 position2;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>position3</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;varying vec3 position3;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>void main() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>color4</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;color4 = aVertexColor;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>texcoords2</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;texcoords2 = aTexCoord;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>normal3</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;normal3 = normalize(uNormalMatrix * aNormal);&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>position2</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;position2 = vec4(aPosition, 1.0).xy;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>position3</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;position3 = vec4(aPosition, 1.0).xyz;&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>target</span><span style=color:#e6db74>}</span><span style=color:#e6db74>;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>advice</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>/*
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Vertex shader code to be coupled with &#39;</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_coupledWith</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74> 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Generated with treegl version </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>INFO</span>.<span style=color:#a6e22e>VERSION</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>_specs</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Feel free to copy, paste, edit and save it.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Refer to createShader (https://p5js.org/reference/#/p5/createShader),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>loadShader (https://p5js.org/reference/#/p5/loadShader), readShader
</span></span></span><span style=display:flex><span><span style=color:#e6db74>and makeShader (https://github.com/VisualComputing/p5.treegl#handling),
</span></span></span><span style=display:flex><span><span style=color:#e6db74>for details.`</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>*/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>advice</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>vertexShader</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>/\r?\n/</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>filter</span>(<span style=color:#a6e22e>line</span> =&gt; <span style=color:#a6e22e>line</span>.<span style=color:#a6e22e>trim</span>() <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#34;\n&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>result</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitMousePosition</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>shader</span>, <span style=color:#a6e22e>uniform</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;u_mouse&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#a6e22e>uniform</span>, [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mouseX</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(), (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mouseY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>()]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitPointerPosition</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>emitPointerPosition</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitPointerPosition</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>shader</span>, <span style=color:#a6e22e>pointerX</span>, <span style=color:#a6e22e>pointerY</span>, <span style=color:#a6e22e>uniform</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;u_pointer&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#a6e22e>uniform</span>, [<span style=color:#a6e22e>pointerX</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(), (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>pointerY</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>()]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitResolution</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>emitResolution</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitResolution</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>shader</span>, <span style=color:#a6e22e>uniform</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;u_resolution&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#a6e22e>uniform</span>, [<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>(), <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>pixelDensity</span>()]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>emitTexOffset</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>shader</span>, <span style=color:#a6e22e>image</span>, <span style=color:#a6e22e>uniform</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;u_texoffset&#39;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shader</span>.<span style=color:#a6e22e>setUniform</span>(<span style=color:#a6e22e>uniform</span>, [<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>image</span>.<span style=color:#a6e22e>width</span>, <span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>image</span>.<span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 4. Utility functions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pixelRatio</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pixelRatio</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Returns the world to pixel ratio units at given world location.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * A line of n * pixelRatio(location) world units will be projected
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * with a length of n pixels on screen.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector | Array} location      world location reference
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pixelRatio</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>location</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_isOrtho</span>() <span style=color:#f92672>?</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tPlane</span>() <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bPlane</span>()) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>abs</span>((<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>(<span style=color:#a6e22e>location</span>, { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_curCamera</span>.<span style=color:#a6e22e>cameraMatrix</span> })).<span style=color:#a6e22e>z</span>) <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>visibility</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>visibility</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Returns object visibility (i.e, lies within the eye bounds)
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * either Tree.VISIBLE, Tree.INVISIBLE, or Tree.SEMIVISIBLE.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Object may be either a point, a sphere or an axis-aligned box.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector | Array} corner1 box corner1, use it with corner2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector | Array} corner2 box corner2, use it with corner1.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Vector | Array} center sphere (or point) center.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}            radius sphere radius.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Array}             bounds frustum equations 6x4 matrix.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>visibility</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>corner1</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>corner2</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>center</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>radius</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bounds</span>()
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>center</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_ballVisibility</span>(<span style=color:#a6e22e>center</span>, <span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>bounds</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_pointVisibility</span>(<span style=color:#a6e22e>center</span>, <span style=color:#a6e22e>bounds</span>)
</span></span><span style=display:flex><span>      <span style=color:#f92672>:</span> <span style=color:#a6e22e>corner1</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>corner2</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_boxVisibility</span>(<span style=color:#a6e22e>corner1</span>, <span style=color:#a6e22e>corner2</span>, <span style=color:#a6e22e>bounds</span>) <span style=color:#f92672>:</span> <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;couldn\&#39;t parse your visibility query!&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_pointVisibility</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>point</span>, <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bounds</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>bounds</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>d</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distanceToBound</span>(<span style=color:#a6e22e>point</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>bounds</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>INVISIBLE</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SEMIVISIBLE</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>VISIBLE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_ballVisibility</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>center</span>, <span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bounds</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>allInForAllPlanes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>bounds</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>d</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distanceToBound</span>(<span style=color:#a6e22e>center</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>bounds</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>d</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>radius</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>INVISIBLE</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ((<span style=color:#a6e22e>d</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> (<span style=color:#f92672>-</span><span style=color:#a6e22e>d</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>radius</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>allInForAllPlanes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allInForAllPlanes</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>VISIBLE</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SEMIVISIBLE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_boxVisibility</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>corner1</span>, <span style=color:#a6e22e>corner2</span>, <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bounds</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>corner1</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>corner1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>corner1</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>corner1</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>corner1</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>corner2</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>corner2</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>corner2</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>corner2</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>corner2</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>allInForAllPlanes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>bounds</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>allOut</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>8</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>c</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(((<span style=color:#a6e22e>c</span> <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>4</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>corner1</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>corner2</span>.<span style=color:#a6e22e>x</span>, ((<span style=color:#a6e22e>c</span> <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>corner1</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>corner2</span>.<span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>          ((<span style=color:#a6e22e>c</span> <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>?</span> <span style=color:#a6e22e>corner1</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>corner2</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>distanceToBound</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>bounds</span>) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>allInForAllPlanes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>allOut</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#75715e>// The eight points are on the outside side of this plane
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allOut</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>INVISIBLE</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allInForAllPlanes</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>VISIBLE</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Too conservative, but tangent cases are too expensive to detect
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SEMIVISIBLE</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>bounds</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Returns the 6 plane equations of the eye frustum bounds defined
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * in the world coordinate system encoded as an object literal
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * having &#39;Tree.LEFT&#39; (left plane), &#39;Tree.RIGHT&#39; (right plane),
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * &#39;Tree.NEAR&#39; (near plane), &#39;Tree.FAR&#39; (far plane) &#39;Tree.TOP&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * (top plane) and &#39;Tree.BOTTOM&#39; (bottom plane) keys.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Each key holds a plane equation of the form:
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * a*x + b*y + c*z + d = 0,  where a, b, c and d are the 4
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * keys of each object literal.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>normals</span> <span style=color:#f92672>=</span> Array(<span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>distances</span> <span style=color:#f92672>=</span> Array(<span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Computed once and for all
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// TODO experimental: no need to normalize
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeLocation</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>], { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>viewDir</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>], { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>    <span style=color:#75715e>// same as: let viewDir = this.treeDisplacement();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>up</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>], { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>right</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_treeDisplacement</span>([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>], { <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>EYE</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posViewDir</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>viewDir</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_isOrtho</span>()) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>right</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>right</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>up</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>up</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>wh0</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>rPlane</span>() <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>lPlane</span>()) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>wh1</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>abs</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>tPlane</span>() <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bPlane</span>()) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>right</span>, <span style=color:#a6e22e>wh0</span>)), <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>right</span>, <span style=color:#a6e22e>wh0</span>)), <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>up</span>, <span style=color:#a6e22e>wh1</span>)), <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>]);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>sub</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>up</span>, <span style=color:#a6e22e>wh1</span>)), <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>]);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hhfov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>hfov</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>chhfov</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>hhfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shhfov</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>hhfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>viewDir</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>shhfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>right</span>, <span style=color:#a6e22e>chhfov</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>right</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>chhfov</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>viewDir</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>viewDir</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hfov</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fov</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>chfov</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>hfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shfov</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>hfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>viewDir</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>shfov</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>], <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>up</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>chfov</span>));
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>], <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>up</span>, <span style=color:#a6e22e>chfov</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distances</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>normals</span>[<span style=color:#a6e22e>i</span>]);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>6</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>j</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>distances</span>[<span style=color:#a6e22e>j</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>normals</span>[<span style=color:#a6e22e>j</span>]);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Natural equations are:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// dist[0,1,4,5] = pos * normal[0,1,4,5];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// dist[2] = (pos + zNear() * viewDir) * normal[2];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// dist[3] = (pos + zFar() * viewDir) * normal[3];
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// 2 times less computations using expanded/merged equations. Dir vectors
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#75715e>// are normalized.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posRightCosHH</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>chhfov</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>right</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>shhfov</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>posViewDir</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>posRightCosHH</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>-</span> <span style=color:#a6e22e>posRightCosHH</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posUpCosH</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>chfov</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#a6e22e>up</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>shfov</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>posViewDir</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>5</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>-</span> <span style=color:#a6e22e>posUpCosH</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>posUpCosH</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Front and far planes are identical for both camera types.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>mult</span>(<span style=color:#a6e22e>viewDir</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>viewDir</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>posViewDir</span> <span style=color:#f92672>-</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>nPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>posViewDir</span> <span style=color:#f92672>+</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>LEFT</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>0</span>] };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>RIGHT</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>1</span>] };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>2</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>2</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>2</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>2</span>] };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>FAR</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>3</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>3</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>3</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>3</span>] };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>TOP</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>4</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>4</span>] };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>BOTTOM</span>] <span style=color:#f92672>=</span> { <span style=color:#a6e22e>a</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>b</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>].<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>c</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>normals</span>[<span style=color:#ae81ff>5</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>d</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>distances</span>[<span style=color:#ae81ff>5</span>] };
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>bounds</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>distanceToBound</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>distanceToBound</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Returns the signed distance between location and the frustum plane defined
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * by bounds and key which may be either Tree.LEFT, Tree.RIGHT, Tree.BOTTOM,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Tree.TOP, Tree.NEAR or Tree.FAR. The distance is negative if the point lies
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * in the planes&#39;s bounding halfspace, and positive otherwise.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>distanceToBound</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>location</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>bounds</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>bounds</span>()) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (Array.<span style=color:#a6e22e>isArray</span>(<span style=color:#a6e22e>location</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>location</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>location</span>[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>location</span>[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>location</span>[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>??</span> <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>.<span style=color:#a6e22e>dot</span>(<span style=color:#a6e22e>location</span>, <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>Vector</span>(<span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>b</span>, <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>c</span>)) <span style=color:#f92672>-</span> <span style=color:#a6e22e>bounds</span>[<span style=color:#a6e22e>key</span>].<span style=color:#a6e22e>d</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>mousePicking</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shape</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>CIRCLE</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pvMatrix</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pointerPicking</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mouseX</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mouseY</span>, { <span style=color:#a6e22e>mMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>size</span>, <span style=color:#a6e22e>shape</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>shape</span>, <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pointerPicking</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>pointerPicking</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Returns true if pointer is close enough to pointerX, pointerY screen location.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} mMatrix model space matrix origin to compute (x, y) from.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    x screen x coordinate. Default is width / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    y screen y coordinate. Default is height / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    size bullseye diameter. Default is 50.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    shape either Tree.CIRCLE, Tree.SQUARE or Tree.PROJECTION. Default is Tree.CIRCLE.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>pointerPicking</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>pointerX</span>, <span style=color:#a6e22e>pointerY</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shape</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>CIRCLE</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pvMatrix</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>screenLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pixelRatio</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO implement webgl picking here using a switch statement: Tree.CIRCLE, Tree.SQUARE, Tree.PROJECTION
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>shape</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>CIRCLE</span> <span style=color:#f92672>?</span>
</span></span><span style=display:flex><span>      Math.<span style=color:#a6e22e>sqrt</span>(Math.<span style=color:#a6e22e>pow</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>pointerX</span>), <span style=color:#ae81ff>2.0</span>) <span style=color:#f92672>+</span> Math.<span style=color:#a6e22e>pow</span>((<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>pointerY</span>), <span style=color:#ae81ff>2.0</span>)) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>radius</span> <span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>      ((Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>pointerX</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>x</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>radius</span>) <span style=color:#f92672>&amp;&amp;</span> (Math.<span style=color:#a6e22e>abs</span>(<span style=color:#a6e22e>pointerY</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>y</span>) <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>radius</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 5. Drawing stuff
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>axes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>axes</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Draws axes.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}  size size in world units.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}  bits bitwise mask that may be composed of Tree.X, Tree._X,
</span></span></span><span style=display:flex><span><span style=color:#75715e>   *                        Tree.Y, Tree._Y, Tree.Z, Tree._Z and Tree.LABELS bits.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>axes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({ <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>bits</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>LABELS</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>X</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Z</span> } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>LABELS</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>charWidth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>40.0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>charHeight</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>30.0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>charShift</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.04</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>size</span>;
</span></span><span style=display:flex><span>      <span style=color:#75715e>// The X
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charWidth</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charHeight</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>charShift</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charHeight</span>);
</span></span><span style=display:flex><span>      <span style=color:#75715e>// The Y
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charHeight</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charHeight</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charHeight</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#ae81ff>0.0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#ae81ff>0.0</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>);
</span></span><span style=display:flex><span>      <span style=color:#75715e>// The Z
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charWidth</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>charWidth</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>, <span style=color:#a6e22e>charWidth</span>, <span style=color:#a6e22e>charHeight</span>, <span style=color:#a6e22e>charShift</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// X Axis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>X</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_X</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Y Axis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Y</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_Y</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Z Axis
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Z</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>size</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_Z</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>grid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>grid</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Draws grid
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}  size grid size in world units. Default is 100.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}  subdivisions number of grid subdivisions. Default is 10.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}  style either Tree.DOTS or Tree.SOLID. Default is Tree.DOTS.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>grid</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({ <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>subdivisions</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>style</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>DOTS</span> } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>style</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>DOTS</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>weight</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>curStrokeWeight</span>;
</span></span><span style=display:flex><span>      <span style=color:#75715e>// other useful as well: this.curStrokeColor this.curFillColor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posi</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>posj</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>weight</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>(<span style=color:#ae81ff>0x0000</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>subdivisions</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>posi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>subdivisions</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>subdivisions</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>j</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>posj</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>subdivisions</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>posi</span>, <span style=color:#a6e22e>posj</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>internalSub</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>subSubdivisions</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>subdivisions</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>internalSub</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>weight</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>(<span style=color:#ae81ff>0x0000</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>subSubdivisions</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>posi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>subSubdivisions</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>subSubdivisions</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>j</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>posj</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>subSubdivisions</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (((<span style=color:#a6e22e>i</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>internalSub</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) <span style=color:#f92672>||</span> ((<span style=color:#a6e22e>j</span> <span style=color:#f92672>%</span> <span style=color:#a6e22e>internalSub</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>posi</span>, <span style=color:#a6e22e>posj</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>subdivisions</span>; <span style=color:#f92672>++</span><span style=color:#a6e22e>i</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>pos</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2.0</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>subdivisions</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1.0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>pos</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>pos</span>, <span style=color:#f92672>+</span><span style=color:#a6e22e>size</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>size</span>, <span style=color:#a6e22e>pos</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>size</span>, <span style=color:#a6e22e>pos</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>cross</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>cross</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Draws a cross on the screen.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} mMatrix model space matrix origin to compute (x, y) from.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    x screen x coordinate. Default is width / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    y screen y coordinate. Default is height / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    size cross size. Default is 50.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>cross</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pvMatrix</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>screenLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pixelRatio</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>half_size</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2.0</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_size</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_size</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_size</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_size</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bullsEye</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>bullsEye</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Draws a bulls-eye on the screen.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.Matrix} mMatrix model space matrix origin to compute (x, y) from.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    x screen x coordinate. Default is width / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    y screen y coordinate. Default is height / 2.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    size bullseye diameter. Default is 50.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}    shape either Tree.CIRCLE or Tree.SQUARE. Default is Tree.CIRCLE.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>bullsEye</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mMatrix</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>mMatrix</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>shape</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>CIRCLE</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>eMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vMatrix</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>pvMatrix</span>
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>y</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>screenLocation</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>SCREEN</span>, <span style=color:#a6e22e>pMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pMatrix</span>, <span style=color:#a6e22e>vMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>vMatrix</span>, <span style=color:#a6e22e>pvMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>pvMatrix</span> });
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>screenLocation</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>size</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pixelRatio</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>treeLocation</span>({ <span style=color:#a6e22e>from</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>mMatrix</span>, <span style=color:#a6e22e>to</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>WORLD</span>, <span style=color:#a6e22e>eMatrix</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>eMatrix</span> }));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>shape</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>CIRCLE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_circle</span>({ <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>radius</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> })
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>half_length</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>size</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2.0</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>+</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>+</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>-</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), ((<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>+</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>)));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), ((<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>-</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>)), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), ((<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>-</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>)), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>+</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>((<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>), (<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>half_length</span>), ((<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>half_length</span>) <span style=color:#f92672>-</span> (<span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>half_length</span>)));
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cross</span>({ <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0.6</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>size</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_circle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>_circle</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_circle</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({ <span style=color:#a6e22e>filled</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>detail</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span> } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>filled</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>(<span style=color:#ae81ff>0x0005</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>t</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>detail</span>; <span style=color:#a6e22e>t</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>detail</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>detail</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.5</span>, <span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>radius</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>radius</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>0</span>, (<span style=color:#a6e22e>x</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>, (<span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span>) <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>PI</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>detail</span>;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lastPosition</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> };
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>detail</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>position</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>cos</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>radius</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> Math.<span style=color:#a6e22e>sin</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>angle</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>radius</span> };
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>lastPosition</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>lastPosition</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>position</span>.<span style=color:#a6e22e>y</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>lastPosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>position</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>viewFrustum</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_renderer</span>.<span style=color:#a6e22e>viewFrustum</span>(...<span style=color:#a6e22e>arguments</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * Display fbo view frustum.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {p5.RendererGL | p5.Graphics} fbo renderer which viewing frustum is to be displayed.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Number}   bits bitwise view-frustum mask that may be composed of Tree.NEAR, Tree.FAR and Tree.BODY bits.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   * @param  {Function} viewer callback fbo visual representation.
</span></span></span><span style=display:flex><span><span style=color:#75715e>   */</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>viewFrustum</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>_renderer</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>bits</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>FAR</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>viewer</span> <span style=color:#f92672>=</span> () =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>axes</span>({ <span style=color:#a6e22e>size</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>bits</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>X</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_X</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Y</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_Y</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>Z</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>_Z</span> })
</span></span><span style=display:flex><span>  } <span style=color:#f92672>=</span> {}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>fbo</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#39;displaying viewFrustum requires an fbo different than this&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>resetMatrix</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>applyMatrix</span>(...<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vMatrix</span>().<span style=color:#a6e22e>mat4</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>applyMatrix</span>(...<span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>eMatrix</span>().<span style=color:#a6e22e>mat4</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>_isOrtho</span>() <span style=color:#f92672>?</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_viewOrtho</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>bits</span>, <span style=color:#a6e22e>viewer</span>) <span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_viewPerspective</span>(<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>bits</span>, <span style=color:#a6e22e>viewer</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>pop</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_rendererState</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_viewOrtho</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>bits</span>, <span style=color:#a6e22e>viewer</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>viewer</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>viewer</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>l</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>lPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>r</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>rPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>bPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>t</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>tPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>nPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>f</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>FAR</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>BODY</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>f</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO implement near plane texture
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>l</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>b</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>, <span style=color:#a6e22e>r</span>, <span style=color:#a6e22e>t</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>n</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>p5</span>.<span style=color:#a6e22e>RendererGL</span>.<span style=color:#a6e22e>prototype</span>.<span style=color:#a6e22e>_viewPerspective</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>fbo</span>, <span style=color:#a6e22e>bits</span>, <span style=color:#a6e22e>viewer</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>viewer</span> <span style=color:#f92672>!==</span> <span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NONE</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>viewer</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>magnitude</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>tan</span>(<span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fov</span>() <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>aspectRatio</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>height</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> },
</span></span><span style=display:flex><span>      { <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span> },
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>nPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fPlane</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>magnitude</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>aspectRatio</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ratio</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ratio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ratio</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>FAR</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>BODY</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// TODO implement near plane texture
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// Something along the lines
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// this.textureMode(NORMAL);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// this.tint(255, 126); // Apply transparency without changing color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// this.texture(fbo);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// doesn&#39;t work since this.texture is not found
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>~</span>(<span style=color:#a6e22e>bits</span> <span style=color:#f92672>|</span> <span style=color:#f92672>~</span><span style=color:#a6e22e>Tree</span>.<span style=color:#a6e22e>NEAR</span>) <span style=color:#f92672>===</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>beginShape</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>vertex</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>endShape</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>line</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>y</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>points</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>})();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Plane</span>(){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeMaxMagR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeColor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;rgb(255, 247, 233)&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeMagnitudeR</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeRotateV</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeSize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>200</span>,<span style=color:#ae81ff>200</span>,<span style=color:#ae81ff>0</span>); <span style=color:#75715e>//ancho y alto
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planePosition</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>draw</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>fbo</span>){
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeColor</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planePosition</span>);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>plane</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>x</span>,<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>planeSize</span>.<span style=color:#a6e22e>y</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Wall</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>originX</span>,<span style=color:#a6e22e>originY</span>,<span style=color:#a6e22e>originZ</span>,<span style=color:#a6e22e>width</span>,<span style=color:#a6e22e>height</span>,<span style=color:#a6e22e>depth</span>, <span style=color:#a6e22e>fillColor</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fillColor</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fillColor</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>origin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>originX</span>,<span style=color:#a6e22e>originY</span>,<span style=color:#a6e22e>originZ</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>width</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>height</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>depth</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>depth</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>originX</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>originY</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>originZ</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>depth</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>originX</span><span style=color:#f92672>-</span><span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>originY</span><span style=color:#f92672>-</span><span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>originZ</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>depth</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)    
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>push</span>()
</span></span><span style=display:flex><span>      <span style=color:#75715e>//fbo.line(this.wallMin.x,this.wallMin.y,this.wallMin.z,this.wallMax.x,this.wallMax.y,this.wallMax.z)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>fill</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fillColor</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>translate</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>x</span>,<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>y</span>,<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>z</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>box</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>width</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>height</span>,<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>depth</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo</span>.<span style=color:#a6e22e>pop</span>()
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>closestPointSphere</span>(<span style=color:#a6e22e>B</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// get box closest point to sphere center by clamping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>x</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>x</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>y</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>y</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>z</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>z</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// this is the same as isPointInsidespherePosition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>isPointInside</span>(<span style=color:#a6e22e>point</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&gt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMin</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>point</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&lt;=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>wallMax</span>.<span style=color:#a6e22e>z</span>
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>collisionWithSphere</span>(<span style=color:#a6e22e>B</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cPoint</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>closestPointSphere</span>(<span style=color:#a6e22e>B</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>distance</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>sqrt</span>(
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>) <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span>) <span style=color:#f92672>*</span> (<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span>)
</span></span><span style=display:flex><span>    ); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sine</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sqrt</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#a6e22e>sq</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>z</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cPointBouncing</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>distance</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>sphereRadius</span>){
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cPointM</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>cPoint</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cPointDir</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>/</span><span style=color:#a6e22e>cPointM</span>,<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>/</span><span style=color:#a6e22e>cPointM</span>,<span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>/</span><span style=color:#a6e22e>cPointM</span>)
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cPointBouncing</span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>x</span>,<span style=color:#f92672>-</span><span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>z</span>)
</span></span><span style=display:flex><span>      <span style=color:#75715e>//ajustar
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>testVec</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>cPointBouncing</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>cPointBouncing</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>cPointBouncing</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>cPoint</span>.<span style=color:#a6e22e>z</span>)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>isPointInside</span>(<span style=color:#a6e22e>testVec</span>)){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>cPointBouncing</span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>cPointDir</span>.<span style=color:#a6e22e>z</span>) 
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cPointBouncing</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fbo1</span>, <span style=color:#a6e22e>cam1</span>, <span style=color:#a6e22e>fovy</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>P</span>,<span style=color:#a6e22e>B</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mouseInitialV</span>,<span style=color:#a6e22e>mouseCurrentV</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>box</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>boxMax</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>boxMin</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vectorCollision</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>wallsData</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>Walls</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startData</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>finishData</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startBox</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>finishBox</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startTime</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>endTime</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>textTime</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isGameStarted</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isGameEnd</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>initState</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>resetBtn</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#34;Reinicio&#34;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resetBtn</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resetBtn</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>initState</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>isGameEnd</span>){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>120</span>, <span style=color:#ae81ff>125</span>, <span style=color:#ae81ff>115</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>reset</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>perspective</span>(<span style=color:#a6e22e>PI</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2.5</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>rotate</span>((<span style=color:#a6e22e>PI</span><span style=color:#f92672>/</span><span style=color:#ae81ff>180</span>)<span style=color:#f92672>*</span><span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeMagnitudeR</span>, <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>0.5</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Inicio y final:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>startBox</span>.<span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo1</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>finishBox</span>.<span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo1</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>finishBox</span>.<span style=color:#a6e22e>collisionWithSphere</span>(<span style=color:#a6e22e>B</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isGameStarted</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isGameEnd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;background-color&#34;</span>,<span style=color:#e6db74>&#34;green&#34;</span>, <span style=color:#e6db74>&#34;color&#34;</span>, <span style=color:#e6db74>&#34;white&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;color&#34;</span>, <span style=color:#e6db74>&#34;white&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>startBox</span>.<span style=color:#a6e22e>collisionWithSphere</span>(<span style=color:#a6e22e>B</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isGameStarted</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isGameStarted</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>second</span>()
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isGameStarted</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>second</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>startTime</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>html</span>(<span style=color:#e6db74>&#34;Tiempo: &#34;</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>endTime</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;s&#34;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>drawListObjects</span>(<span style=color:#a6e22e>Walls</span>, <span style=color:#a6e22e>fbo1</span>)
</span></span><span style=display:flex><span>  <span style=color:#75715e>// movimiento de la esfera 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vectorCollision</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>*</span><span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>sphereRadius</span><span style=color:#f92672>+</span><span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>*</span><span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>sphereRadius</span><span style=color:#f92672>+</span><span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>,<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>  <span style=color:#75715e>// fbo1.push()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// fbo1.translate(vectorCollision.x,vectorCollision.y,vectorCollision.z)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// fbo1.fill(&#34;red&#34;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// fbo1.sphere(5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// fbo1.pop()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>//console.log(vectorCollision.x);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Colisión con la pared
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>collisionV</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>collisionWalls</span>(<span style=color:#a6e22e>Walls</span>, <span style=color:#a6e22e>B</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>collisionV</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Colisiones&#34;</span>, <span style=color:#a6e22e>collisionWalls</span>(<span style=color:#a6e22e>Walls</span>,<span style=color:#a6e22e>B</span>), <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>currentAccMod</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>//collisionV = createVector(B.acceleration.x, B.acceleration.y, B.acceleration.z)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>), <span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>collisionV</span>));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>P</span>,<span style=color:#a6e22e>collisionV</span>, <span style=color:#ae81ff>0.6</span>,<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Normal&#34;</span>, <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>move</span>(<span style=color:#a6e22e>P</span>, <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span>, <span style=color:#ae81ff>0.1</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// if(P.planeRotateV.x != 0 || P.planeRotateV.y != 0){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     B.sphereMoveVector.x = (B.acceleration.x*0.1) + B.sphereMoveVector.x;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     B.sphereMoveVector.y = (B.acceleration.y*0.1) + B.sphereMoveVector.y;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     
</span></span><span style=display:flex><span>    <span style=color:#75715e>//     B.spherePosition.x = (B.sphereMoveVector.x*0.1) + B.spherePosition.x
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     B.spherePosition.y = (B.sphereMoveVector.y*0.1) + B.spherePosition.y;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     
</span></span><span style=display:flex><span>    <span style=color:#75715e>//   }else if(P.planeRotateV.x == 0 &amp;&amp; P.planeRotateV.y == 0){
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     B.sphereMoveVector = createVector(0,0,0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//     B.acceleration = createVector(0,0,0);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>//   }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> }
</span></span><span style=display:flex><span>  <span style=color:#75715e>//Colisión
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>minVertex</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>minVertex</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>minVertex</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>&amp;&amp;</span>
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>maxVertex</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>maxVertex</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>&amp;&amp;</span> 
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>maxVertex</span>.<span style=color:#a6e22e>z</span>){
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeColor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;white&#34;</span>    
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeColor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;rgba(255, 247, 233,1)&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>beginHUD</span>();
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>image</span>(<span style=color:#a6e22e>fbo1</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>endHUD</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>vector</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> Math.<span style=color:#a6e22e>sqrt</span>(<span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>**</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>**</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span><span style=color:#a6e22e>vector</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mousePressed</span>() {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mouseInitialV</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>mouseX</span>, <span style=color:#a6e22e>mouseY</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>mouseDragged</span>(){
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>mouseCurrentV</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>mouseX</span>, <span style=color:#a6e22e>mouseY</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vectorSubstra</span> <span style=color:#f92672>=</span>  <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>mouseInitialV</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mouseCurrentV</span>.<span style=color:#a6e22e>x</span>,
</span></span><span style=display:flex><span>                                    <span style=color:#a6e22e>mouseInitialV</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mouseCurrentV</span>.<span style=color:#a6e22e>y</span>,
</span></span><span style=display:flex><span>                                    <span style=color:#a6e22e>mouseInitialV</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>mouseCurrentV</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mod</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getVectorModule</span>(<span style=color:#a6e22e>vectorSubstra</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>vectorDir</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>vectorSubstra</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mod</span>,
</span></span><span style=display:flex><span>                               <span style=color:#a6e22e>vectorSubstra</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mod</span>,
</span></span><span style=display:flex><span>                               <span style=color:#a6e22e>vectorSubstra</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>/</span><span style=color:#a6e22e>mod</span> );
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sine</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sqrt</span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>-</span><span style=color:#a6e22e>sq</span>(<span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>z</span>));
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>B</span>.<span style=color:#a6e22e>acceleration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>x</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>sine</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>aux</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>x</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>y</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vectorDir</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>aux</span>;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>mod</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeMaxMagR</span>){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeMagnitudeR</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>mod</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>vectorDir</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>P</span>.<span style=color:#a6e22e>planeRotateV</span>.<span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>closestPoint</span>(<span style=color:#a6e22e>spherePosition</span>, <span style=color:#a6e22e>boxMin</span>, <span style=color:#a6e22e>boxMax</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// get box closest point to sphere center by clamping
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>boxMin</span>.<span style=color:#a6e22e>x</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>boxMax</span>.<span style=color:#a6e22e>x</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>boxMin</span>.<span style=color:#a6e22e>y</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>boxMax</span>.<span style=color:#a6e22e>y</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>z</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>boxMin</span>.<span style=color:#a6e22e>z</span>, Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>spherePosition</span>.<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>boxMax</span>.<span style=color:#a6e22e>z</span>));
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>    <span style=color:#75715e>// this is the same as isPointInsidespherePosition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>z</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>dataToWalls</span>(<span style=color:#a6e22e>wallsData</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>walls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>wallsData</span>.<span style=color:#a6e22e>map</span>(({<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>z</span>,<span style=color:#a6e22e>width</span>,<span style=color:#a6e22e>height</span>,<span style=color:#a6e22e>depth</span>, <span style=color:#a6e22e>fillColor</span>}) =&gt;{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Wall</span>(<span style=color:#a6e22e>x</span>,<span style=color:#a6e22e>y</span>,<span style=color:#a6e22e>z</span>,<span style=color:#a6e22e>width</span>,<span style=color:#a6e22e>height</span>,<span style=color:#a6e22e>depth</span>,<span style=color:#a6e22e>fillColor</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>walls</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawListObjects</span>(<span style=color:#a6e22e>list</span>, <span style=color:#a6e22e>fbo</span>){
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>list</span>.<span style=color:#a6e22e>forEach</span>(<span style=color:#a6e22e>object</span> =&gt;{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>object</span>.<span style=color:#a6e22e>draw</span>(<span style=color:#a6e22e>fbo</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>collisionWalls</span>(<span style=color:#a6e22e>walls</span>, <span style=color:#a6e22e>B</span>) {  
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;<span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>walls</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>cNewVector</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>walls</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>collisionWithSphere</span>(<span style=color:#a6e22e>B</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>cNewVector</span>){
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cNewVector</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>initState</span>(){
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>endTime</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isGameStarted</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isGameEnd</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createP</span>(<span style=color:#e6db74>&#39;this is some text&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>html</span>(<span style=color:#e6db74>&#34;Tiempo: &#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>350</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textTime</span>.<span style=color:#a6e22e>style</span>(<span style=color:#e6db74>&#34;background-color&#34;</span>,<span style=color:#e6db74>&#34;white&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startData</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;2&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4.5</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgb(255, 115, 29)&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>finishData</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;2&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#f92672>+</span><span style=color:#ae81ff>2.5</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgb(255, 115, 29)&#34;</span>}
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>startBox</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Wall</span>(<span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>width</span>,<span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>height</span>, <span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>depth</span>,<span style=color:#a6e22e>startData</span>.<span style=color:#a6e22e>fillColor</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>finishBox</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Wall</span>(<span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>z</span>, <span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>width</span>,<span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>height</span>, <span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>depth</span>,<span style=color:#a6e22e>finishData</span>.<span style=color:#a6e22e>fillColor</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wallsData</span> <span style=color:#f92672>=</span> [{<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;200&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>100</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;200&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>100</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;200&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>100</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Fila 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Fila 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>3</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Fila3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Fila 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Columna 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>4</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Columna 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>3</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>3</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Columna 3
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 
</span></span><span style=display:flex><span>                 <span style=color:#75715e>//Columna 4
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span><span style=color:#f92672>*-</span><span style=color:#ae81ff>2</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;5&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;38&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>92.5</span><span style=color:#f92672>-</span><span style=color:#ae81ff>38</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1</span>,<span style=color:#a6e22e>y</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>38</span>,<span style=color:#a6e22e>z</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                 {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;200&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>x</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>y</span><span style=color:#f92672>:</span><span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>z</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>fillColor</span><span style=color:#f92672>:</span><span style=color:#e6db74>&#34;rgba(95, 157, 247,0.5)&#34;</span>},
</span></span><span style=display:flex><span>                ]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Walls</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dataToWalls</span>(<span style=color:#a6e22e>wallsData</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>box</span> <span style=color:#f92672>=</span> {<span style=color:#a6e22e>width</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;100&#34;</span>, <span style=color:#a6e22e>height</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;10&#34;</span>, <span style=color:#a6e22e>depth</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;20&#34;</span>, <span style=color:#a6e22e>origin</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>50</span>,<span style=color:#ae81ff>10</span>)}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>boxMax</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>+</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>depth</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>boxMin</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createVector</span>(<span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>x</span><span style=color:#f92672>-</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>width</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>y</span><span style=color:#f92672>-</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>height</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>.<span style=color:#a6e22e>z</span><span style=color:#f92672>-</span> <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>depth</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;origin &#34;</span>, <span style=color:#a6e22e>box</span>.<span style=color:#a6e22e>origin</span>, <span style=color:#e6db74>&#34;max: &#34;</span>, <span style=color:#a6e22e>boxMin</span>,<span style=color:#e6db74>&#34;min: &#34;</span>, <span style=color:#a6e22e>boxMax</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fbo1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createGraphics</span>(<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>height</span>, <span style=color:#a6e22e>WEBGL</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#75715e>// FBO camera
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cam1</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dw</span>.<span style=color:#a6e22e>EasyCam</span>(<span style=color:#a6e22e>fbo1</span>.<span style=color:#a6e22e>_renderer</span>, { <span style=color:#a6e22e>distance</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>200</span> });
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>state1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>getState</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>state_reset</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state1</span>;   <span style=color:#75715e>// state to use on reset (double-click/tap)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>cam1</span>.<span style=color:#a6e22e>setViewport</span>([<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>height</span>]);
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>oncontextmenu</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () { <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>; }
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#75715e>// scene interactions
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>P</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Plane</span>();
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>B</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Ball</span>(<span style=color:#a6e22e>P</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></div></details><iframe id=sketch style=width:450px;height:450px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            <script src=https://cdn.jsdelivr.net/gh/VisualComputing/p5.treegl/p5.treegl.js></script>
            <script src=https://cdn.jsdelivr.net/gh/freshfork/p5.EasyCam@1.2.1/p5.easycam.js></script>
            
            
            
            
            
            <script src=/visual_computing/sketches/maze/sketch.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe></p><hr><h1 id=conclusiones>Conclusiones
<a class=anchor href=#conclusiones>#</a></h1><ul><li><strong>P5.treegl</strong> Permitio que la realizacion del ejercicio fuera un poco mas simple de lo que se hubiese logrado a fuerza bruta, sin embargo p5.js presenta muchas desventajas al momento de simular fisicas en los objetos ya que para crearlos son pocos los parametros que existen por lo cual no se recomienda para personas no experimentadas.</li><li>El Funcionamiento de tipo vectorial que existe en <strong>P5</strong> permite una aproximacion matematica para la manipulacion del espacio y los objetos creados en el.</li></ul><h1 id=referencias>Referencias
<a class=anchor href=#referencias>#</a></h1><blockquote class="book-hint warning"><ul><li>[1] <em>“Reference | p5.js,”</em> <strong>p5js.org.</strong> <a href=https://p5js.org/es/reference/>https://p5js.org/es/reference/</a> (accessed Oct. 18, 2022).</li><li>[2] <em>“p5.treegl,”</em> <strong>GitHub</strong>, Sep. 12, 2022. <a href=https://github.com/VisualComputing/p5.treegl>https://github.com/VisualComputing/p5.treegl</a> (accessed Oct. 18, 2022).</li><li>[3] <em>“Laberinto,”</em> <strong>Wikipedia</strong>, Aug. 24, 2022. <a href=https://es.wikipedia.org/wiki/Laberinto>https://es.wikipedia.org/wiki/Laberinto</a> (accessed Oct. 18, 2022).</li></ul></blockquote></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/Dicarvajalb/visual_computing/commit/dc0c448b7b93dc773e440d289f3905c039f7e7ae title='Last modified by acardenasor | October 19, 2022' target=_blank rel=noopener><img src=/visual_computing/svg/calendar.svg class=book-icon alt=Calendar>
<span>October 19, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#parte-2>Parte 2</a></li></ul></li><li><a href=#conclusiones>Conclusiones</a></li><li><a href=#referencias>Referencias</a></li></ul></nav></div></aside></main></body></html>